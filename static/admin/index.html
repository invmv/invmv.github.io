<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Content Manager</title>
  </head>
  <body>
    <!-- Include the script that builds the page and powers Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on('login', (user) => {
          const accessToken = user.token.access_token;
    
          fetch('https://api.github.com/user', {
            headers: {
              Authorization: `Bearer ${accessToken}`,
            },
          })
            .then((response) => response.json())
            .then((data) => {
              const authorsField = document.querySelector('[name="authors"]');
              if (authorsField) {
                authorsField.value = JSON.stringify([
                  {
                    name: data.login,
                    image: data.avatar_url,
                    link: data.html_url,
                  },
                ]);
              }
            });
        });
      }
    </script>    
  </body>
</html>
